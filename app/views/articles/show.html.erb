<div class="sidebar">
  <div class="feed">
    <div class="like-form">
      <%= render 'likes/form'%>
    </div>
    <div class="bad-form">
      <%= render 'bads/form'%>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-8 col-sm-8 col-xs-8 article-body
      col-md-offset-1 col-sm-offset-1 col-xs-offset-1">
      <div class="article-header">
        <div class="article-header-left">
          <span><%= user_image_for(@article.user) %></span>
          <span><%= link_to @article.user.name, @article.user %></span>
          <span class="time"><%= @article.updated_at.strftime('%Y年%m月%d日に更新')%></span>
        </div>
        <!-- 画面右上：current_userなら編集、その他はfollow_buttonを表示 -->
        <div class="article-header-right" id="follow">
          <% if @article.user == current_user%>
            <%= link_to "編集", edit_article_path(@article), class: "btn btn-orange"%>
          <% else %>
            <span>{{user_id}}</span>
            <span>{{follow_id}}</span>
            <button @click="create"  class="btn btn-orange">Follow</button>
            <p v-show="loading">{{ message }}</p>
          <%end%>
        </div>
      </div>
      <div class="title">
        <h1>
        <%= @article.title %>
        </h1>
      </div>
      <div class="content">
        <%= qiita_markdown(@article.content) %>
      </div>
      <div class="article-footer">
        <div class="feed">
          <div class="like-form">
            <%= render 'likes/form'%>
          </div>
          <div class="bad-form">
            <%= render 'bads/form'%>
          </div>
        </div>
        <div class="social-share-button">
          <%= social_share_button_tag(@article.title,
            allow_sites: %w(twitter pinterest linkedin google_plus)) %>
        </div>
      </div>
    </div>
    <div class="col-md-8 col-sm-8 col-xs-8 comments
      offset-xs-1 offset-sm-1 offset-md-1">
      <div class="comment-index">
        <%= render @article.comments %>
      </div>
      <div class="comment-form">
        <% if current_user %>
          <%= render 'comments/form' %>
        <% end %>
      </div>
    </div>
  </div>
</div>


<script type="text/javascript">
window.onload = function() {
var vm = new Vue({
  el: '#follow',
  data: {
    loading: false,
     message: '送信中です',
    follow_state: false,
    user_id: "<%= current_user.id %>",
    follow_id: "<%= @article.user.id %>"
    },
  methods: {
    create: function() {
      // this.loading = !this.loading;
      // var that = this,
      //       hostname = window.location.hostname,
      //       protocol = window.location.protocol,
      //       port =  window.location.port,
      //       baseURL = [protocol,'//', hostname,':', port, '/follows'].join('');
      //
      //       var params = {
      //           url: baseURL,
      //           method: 'POST',
      //           data: { user_id: that.user_id, follow_id: that.follow_id }
      //       }
      //       $.ajax(params).done(function(response){
      //            that.message = '送信完了しました';
      //       });
      axios.post('/follow', {
        user_id: this.user_id,
        follow_id: this.follow_id
      })
      .then(function (response) {
        console.log(response);
      })
      .catch(function (error) {
        console.log(error);
      });
    }
  }
});
};


</script>
